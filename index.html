<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FLXæ ‡ç­¾é¡µ</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://feli.dpdns.org/favicon.ico">
</head>
<body>
  <header class="flx-header">
    <h1>FLX</h1>
    <div class="search-engine-switch">
      <button data-engine="bing" class="active">Bing</button>
      <button data-engine="google">Google</button>
      <button data-engine="baidu">ç™¾åº¦</button>
    </div>
    <button id="dark-toggle" style="margin-left:1.5rem;padding:0.5rem 1.2rem;border-radius:20px;border:none;background:#f5f7fa;cursor:pointer;font-size:1rem;transition:background 0.2s;">ğŸŒ™ æš—é»‘æ¨¡å¼</button>
    <button id="wall-toggle" style="margin-left:1.5rem;padding:0.5rem 1.2rem;border-radius:20px;border:none;background:#f5f7fa;cursor:pointer;font-size:1rem;transition:background 0.2s;">ğŸ–¼ï¸ å£çº¸/ä¸»é¢˜</button>
    <div class="flx-widgets">
      <span id="flx-weather" style="margin-right:1.5rem;color:#4f8cff;font-weight:500">å¤©æ°”åŠ è½½ä¸­...</span>
      <span id="flx-time" style="color:#00c6fb;font-weight:500">00:00:00</span>
    </div>
  </header>
  <main>
    <form id="search-form">
      <input type="text" id="search-input" placeholder="æœç´¢ç‚¹ä»€ä¹ˆå­..." autocomplete="off" aria-label="æœç´¢">
      <div id="search-suggest" style="position:absolute;z-index:99;top:100%;left:0;width:100%;background:var(--card-bg);border-radius:0 0 16px 16px;box-shadow:0 2px 8px rgba(0,0,0,0.07);display:none;"></div>
      <button type="submit">æœç´¢</button>
    </form>
    <section class="quick-links">
      <h2>å¸¸ç”¨ç½‘ç«™</h2>
      <form id="site-form" style="display:flex;gap:0.7rem;margin-bottom:1rem;">
        <input type="text" id="site-name" placeholder="åç§°" style="flex:1;padding:0.7rem 1rem;border-radius:12px;border:1px solid #e0eafc;font-size:1rem;">
        <input type="url" id="site-url" placeholder="ç½‘å€ https://" style="flex:2;padding:0.7rem 1rem;border-radius:12px;border:1px solid #e0eafc;font-size:1rem;">
        <button type="submit" style="padding:0.7rem 1.2rem;border-radius:12px;border:none;background:linear-gradient(90deg,#4f8cff,#00c6fb);color:#fff;font-size:1rem;">æ·»åŠ </button>
      </form>
      <div class="links-grid" id="site-list"></div>
    </section>
    <section class="flx-todo">
      <h2>å¾…åŠ / ä¾¿ç­¾</h2>
      <form id="todo-form" style="display:flex;gap:0.7rem;margin-bottom:1rem;">
        <input type="text" id="todo-input" placeholder="å†™ç‚¹ä»€ä¹ˆ..." autocomplete="off" style="flex:1;padding:0.7rem 1rem;border-radius:12px;border:1px solid #e0eafc;font-size:1rem;">
        <button type="submit" style="padding:0.7rem 1.2rem;border-radius:12px;border:none;background:linear-gradient(90deg,#4f8cff,#00c6fb);color:#fff;font-size:1rem;">æ·»åŠ </button>
      </form>
      <ul id="todo-list" style="list-style:none;padding:0;margin:0;"></ul>
    </section>
  </main>
  <footer>
    <span>Â© 2025 FELIX | FLXæ ‡ç­¾é¡µ | Cloudflare</span>
  </footer>
  <script src="main.js"></script>
  <script src="widget.js"></script>
  <script>
    // æš—é»‘æ¨¡å¼åˆ‡æ¢
    const darkBtn = document.getElementById('dark-toggle');
    function setDarkMode(on) {
      if(on){
        document.body.classList.add('dark-mode');
        darkBtn.textContent = 'â˜€ï¸ äº®è‰²æ¨¡å¼';
        localStorage.setItem('flx-dark','1');
      }else{
        document.body.classList.remove('dark-mode');
        darkBtn.textContent = 'ğŸŒ™ æš—é»‘æ¨¡å¼';
        localStorage.setItem('flx-dark','0');
      }
    }
    darkBtn.onclick = ()=>setDarkMode(!document.body.classList.contains('dark-mode'));
    // è‡ªåŠ¨è¯»å–
    if(localStorage.getItem('flx-dark')==='1'||(window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches)){
      setDarkMode(true);
    }
    // å¾…åŠåŠŸèƒ½
    const todoForm = document.getElementById('todo-form');
    const todoInput = document.getElementById('todo-input');
    const todoList = document.getElementById('todo-list');
    function renderTodo(){
      todoList.innerHTML = '';
      const arr = JSON.parse(localStorage.getItem('flx-todo')||'[]');
      if(arr.length===0){
        todoList.innerHTML = '<li style="color:#888;padding:1.2rem;text-align:center;">æš‚æ— å¾…åŠäº‹é¡¹</li>';
        return;
      }
      arr.forEach((item,i)=>{
        const li = document.createElement('li');
        li.textContent = item;
        li.style.cssText = 'background:var(--card-bg);margin-bottom:0.5rem;padding:0.7rem 1rem;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.04);display:flex;justify-content:space-between;align-items:center;';
        const delBtn = document.createElement('button');
        delBtn.textContent = 'åˆ é™¤';
        delBtn.style.cssText = 'margin-left:1rem;padding:0.3rem 0.8rem;border-radius:8px;border:none;background:#ff4f4f;color:#fff;cursor:pointer;font-size:0.95rem;';
        delBtn.onclick = ()=>{
          arr.splice(i,1);
          localStorage.setItem('flx-todo',JSON.stringify(arr));
          renderTodo();
        };
        li.appendChild(delBtn);
        todoList.appendChild(li);
      });
    }
    todoForm.onsubmit = function(e){
      e.preventDefault();
      const val = todoInput.value.trim();
      if(!val){
        todoInput.style.borderColor = '#ff4f4f';
        todoInput.placeholder = 'ä¸èƒ½ä¸ºç©ºï¼';
        setTimeout(()=>{
          todoInput.style.borderColor = '';
          todoInput.placeholder = 'å†™ç‚¹ä»€ä¹ˆ...';
        },1200);
        return;
      }
      const arr = JSON.parse(localStorage.getItem('flx-todo')||'[]');
      arr.push(val);
      localStorage.setItem('flx-todo',JSON.stringify(arr));
      todoInput.value = '';
      renderTodo();
    };
    renderTodo();
    // å£çº¸/ä¸»é¢˜åˆ‡æ¢
    const wallBtn = document.getElementById('wall-toggle');
    const presetWalls = [
      'linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%)',
      'linear-gradient(120deg, #232526 0%, #414345 100%)',
      'url(https://feli.dpdns.org/bg1.jpg)',
      'url(https://feli.dpdns.org/bg2.jpg)',
      'url(https://feli.dpdns.org/bg3.jpg)'
    ];
    let wallIdx = parseInt(localStorage.getItem('flx-wall')||'0');
    function setWall(idx){
      wallIdx = idx;
      document.body.style.background = presetWalls[idx];
      localStorage.setItem('flx-wall',idx);
    }
    wallBtn.onclick = function(){
      wallIdx = (wallIdx+1)%presetWalls.length;
      setWall(wallIdx);
    };
    setWall(wallIdx);
    // å¿«æ·æœç´¢å»ºè®®
    const searchInput = document.getElementById('search-input');
    const suggestBox = document.getElementById('search-suggest');
    const hotWords = ['Bç«™','Felix','GitHub','å¤©æ°”æŸ¥è¯¢','HTMLæ•™ç¨‹','CSSåŠ¨ç”»','PHPç™»å½•','Cloudflare',
      'Javaæ•™ç¨‹','C++æ•™ç¨‹','Cè¯­è¨€æ•™ç¨‹','ç®—æ³•ä¸æ•°æ®ç»“æ„','æœºå™¨å­¦ä¹ ','æ·±åº¦å­¦ä¹ ','è®¡ç®—æœºç½‘ç»œ','æ“ä½œç³»ç»Ÿ','è½¯ä»¶å·¥ç¨‹',
      'JavaScript','Python','Vue.js','React','Node.js','å‰ç«¯å¼€å‘','åç«¯å¼€å‘','å…¨æ ˆå·¥ç¨‹å¸ˆ','Webå¼€å‘',
      'Linuxæ•™ç¨‹','Dockerå…¥é—¨','Kubernetes','MySQLæ•™ç¨‹','MongoDB','Redis','APIè®¾è®¡','RESTfulæ¶æ„',
      'GraphQL','TypeScript','Flutterå¼€å‘','ç§»åŠ¨ç«¯å¼€å‘'];
    function getHistory(){
      return JSON.parse(localStorage.getItem('flx-search-hist')||'[]');
    }
    function addHistory(word){
      let arr = getHistory();
      if(!arr.includes(word)){
        arr.unshift(word);
        if(arr.length>10)arr.pop();
        localStorage.setItem('flx-search-hist',JSON.stringify(arr));
      }
    }
    searchInput.addEventListener('input',function(){
      const val = this.value.trim();
      let list = [];
      if(val){
        // ä¼˜åŒ–ï¼šå»ºè®®å»é‡
        const merged = hotWords.filter(w=>w.includes(val)).concat(getHistory().filter(w=>w.includes(val)));
        list = Array.from(new Set(merged));
      }else{
        list = getHistory();
      }
      if(list.length){
        suggestBox.innerHTML = list.map(w=>`<div style='padding:0.7rem 1rem;cursor:pointer;'>${w}</div>`).join('');
        suggestBox.style.display = 'block';
      }else{
        suggestBox.style.display = 'none';
      }
    });
    suggestBox.addEventListener('mousedown',function(e){
      if(e.target&&e.target.textContent){
        searchInput.value = e.target.textContent;
        suggestBox.style.display = 'none';
      }
    });
    document.getElementById('search-form').addEventListener('submit',function(){
      addHistory(searchInput.value.trim());
      suggestBox.style.display = 'none';
    });
    document.body.addEventListener('click',function(e){
      if(e.target!==searchInput)suggestBox.style.display='none';
    });
    // å¸¸ç”¨ç½‘ç«™ç®¡ç†
    const defaultSites = [
      {name:'å“”å“©å“”å“©',url:'https://www.bilibili.com/'},
      {name:'Felixçš„ä¸»é¡µ',url:'https://feli.dpdns.org/'},
      {name:'GitHub',url:'https://github.com/'},
      {name:'åšå®¢å›­',url:'https://www.cnblogs.com/'},
      {name:'çŸ¥ä¹',url:'https://www.zhihu.com/'},
      {name:'æ·˜å®',url:'https://www.taobao.com/'}
    ];
    function getSites(){
      return JSON.parse(localStorage.getItem('flx-sites')||'null')||defaultSites;
    }
    function setSites(arr){
      localStorage.setItem('flx-sites',JSON.stringify(arr));
    }
    function renderSites(){
      const arr = getSites();
      const grid = document.getElementById('site-list');
      grid.innerHTML = '';
      if(arr.length===0){
        grid.innerHTML = '<div style="color:#888;padding:1.2rem;text-align:center;">æš‚æ— å¸¸ç”¨ç½‘ç«™</div>';
        return;
      }
      arr.forEach((site,i)=>{
        const a = document.createElement('a');
        a.href = site.url;
        a.textContent = site.name;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.style.cssText = 'position:relative;';
        // ç¼–è¾‘æŒ‰é’®
        const editBtn = document.createElement('button');
        editBtn.textContent = 'âœï¸';
        editBtn.title = 'ä¿®æ”¹';
        editBtn.style.cssText = 'position:absolute;top:6px;right:36px;padding:0.2rem 0.5rem;border-radius:8px;border:none;background:#ffe066;color:#222;cursor:pointer;font-size:0.9rem;';
        editBtn.onclick = function(e){
          e.preventDefault();
          document.getElementById('site-name').value = site.name;
          document.getElementById('site-url').value = site.url;
          grid.dataset.edit = i;
        };
        // å³é”®èœå•ï¼šä¿®æ”¹å­—ä½“å’Œåç§°
        a.addEventListener('contextmenu',function(e){
          e.preventDefault();
          let newName = prompt('ä¿®æ”¹ç½‘ç«™åç§°',site.name);
          if(newName!==null&&newName.trim()){
            arr[i].name = newName.trim();
          }
          let newFont = prompt('è‡ªå®šä¹‰å­—ä½“ï¼ˆå¦‚ Segoe UI, Arialï¼‰',a.style.fontFamily||'');
          if(newFont!==null&&newFont.trim()){
            a.style.fontFamily = newFont.trim();
            arr[i].font = newFont.trim();
          }
          setSites(arr);
          renderSites();
        });
        // åˆ é™¤æŒ‰é’®
        const delBtn = document.createElement('button');
        delBtn.textContent = 'ğŸ—‘ï¸';
        delBtn.title = 'åˆ é™¤';
        delBtn.style.cssText = 'position:absolute;top:6px;right:6px;padding:0.2rem 0.5rem;border-radius:8px;border:none;background:#ff4f4f;color:#fff;cursor:pointer;font-size:0.9rem;';
        delBtn.onclick = function(e){
          e.preventDefault();
          arr.splice(i,1);
          setSites(arr);
          renderSites();
        };
        a.appendChild(editBtn);
        a.appendChild(delBtn);
        grid.appendChild(a);
      });
    }
    document.getElementById('site-form').onsubmit = function(e){
      e.preventDefault();
      const name = document.getElementById('site-name').value.trim();
      const url = document.getElementById('site-url').value.trim();
      if(!name||!url||!/^https?:\/\/.+/.test(url)){
        document.getElementById('site-name').style.borderColor = name?'':'#ff4f4f';
        document.getElementById('site-url').style.borderColor = url.match(/^https?:\/\/.+/)?'':'#ff4f4f';
        setTimeout(()=>{
          document.getElementById('site-name').style.borderColor = '';
          document.getElementById('site-url').style.borderColor = '';
        },1200);
        return;
      }
      let arr = getSites();
      if(document.getElementById('site-list').dataset.edit){
        arr[parseInt(document.getElementById('site-list').dataset.edit)] = {name,url};
        document.getElementById('site-list').dataset.edit = '';
      }else{
        arr.push({name,url});
      }
      setSites(arr);
      renderSites();
      document.getElementById('site-name').value = '';
      document.getElementById('site-url').value = '';
    };
    renderSites();
  </script>
</body>
</html>